<div class="btn-group btn-group-toggle float-right mb-3" data-toggle="buttons">
    <label class="btn btn-primary active">
        <input type="radio" onclick="toggleView(this)" id="table-btn" autocomplete="off" checked> Table
    </label>
    <label class="btn btn-secondary">
        <input type="radio" onclick="toggleView(this)" id="chart-btn" autocomplete="off"> Chart
    </label>
</div>

<script>
    function toggleView(e) {
        $('#generated-table').collapse('toggle')
        $('#generated-charts').collapse('toggle')
    }
</script>


{{ $path := .Get 0 }}
{{ $fullPath := .Page.RelPermalink }}
{{ $isRelative := or (eq (substr $path 0 2) "./") (eq (substr $path 0 3) "../")}}
{{ if $isRelative }}
    {{ $path = path.Join $fullPath $path }}
{{ end }}
<!-- Exclude subpath (fix only for github pages hosting) -->
{{ $path = replace $path "/dashboards/" ""}}
{{ $JSON := readFile $path}}

<!-- Loading and creating JSON tables -->
<script>

    function createTable(items) {
        let columns = Object.keys(items[0]);
        let table = composeTable(columns);

        for (let item of items) {
            let tr = table.tBodies[0].insertRow(-1);
            for (let column of columns) {
                let td = tr.insertCell(-1);
                td.innerText = item[column];
            }
        }

        document.getElementsByClassName('td-content')[0].appendChild(table);
    }

    function composeTable(columns) {
        let table = document.createElement('table');
        table.id = 'generated-table';
        table.setAttribute('class', 'table table-hover collapse show');
        table.setAttribute('width', '100%');
        table.createTHead();
        table.createTBody();

        let tr = table.tHead.insertRow(0);

        for (let column of columns) {
            let th = document.createElement('th');
            th.setAttribute('scope', 'col');
            th.innerText = column;

            tr.appendChild(th);
        }
        return table;
    }

    createTable(JSON.parse({{ $JSON }}));

</script>


<!-- Generating charts -->
<div class="row collapse" id="generated-charts"></div>

<script>
    function getRandomColors(count) {
        colors = [];
        let letters = '0123456789ABCDEF';
        for (let i = 0; i < count; i++) {
            let color = '#';
            for (var j = 0; j < 6; j++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            colors.push(color);
        }
        return colors
    }

    function getNumericData(items) {
        let columns = [];
        for (let item of items) {
            for (let column of Object.keys(item)) {
                if (!isNaN(parseFloat(item[column])) && !columns.includes(column)) {
                    columns.push(column);
                } 
            }
        }
        return columns;
    }

    function generateCanvas(labels, values, parameter) {
        let canvas = document.createElement('canvas');
        canvas.id = 'generated-chart-' + parameter;
        canvas.setAttribute('width', "400");
        canvas.setAttribute('height', "250");
        canvas.setAttribute('class', "mt-3");

        const ctx = canvas.getContext('2d');
        const myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: parameter,
                    data: values,
                    backgroundColor: getRandomColors(values.length),

                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        return canvas;
    }


    let data = JSON.parse({{ $JSON }});
    let columns = getNumericData(data);

    for (let column of columns) {
        let parameter = null;
        let labels = [];
        let values = [];

        for (let item of data) {
            labels.push(item['Component']);
            values.push(parseFloat(item[column]));
        }

        let canvas = generateCanvas(labels, values, column);

        document.getElementById('generated-charts').appendChild(canvas);
    }
    
    
    
</script>